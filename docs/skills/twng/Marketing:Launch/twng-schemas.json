{
  "schemas": {
    "guitar_entry": {
      "description": "Core data structure for a single guitar in the TWNG system",
      "schema": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique identifier"
        },
        "owner_id": {
          "type": "string | null",
          "format": "uuid",
          "description": "TWNG user ID if claimed, null if unclaimed"
        },
        "source": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["instagram", "manual", "import"],
              "description": "How this entry was created"
            },
            "platform_handle": {
              "type": "string",
              "description": "Original poster's handle (e.g., @username)"
            },
            "original_post_url": {
              "type": "string",
              "format": "uri",
              "description": "Link to original post"
            },
            "scraped_at": {
              "type": "string",
              "format": "date-time",
              "description": "When the data was scraped"
            }
          }
        },
        "guitar": {
          "type": "object",
          "properties": {
            "brand": { "type": "string", "description": "Manufacturer (Gibson, Fender, etc.)" },
            "model": { "type": "string", "description": "Model name (Les Paul, Stratocaster, etc.)" },
            "sub_model": { "type": "string | null", "description": "Variant (Standard, Custom, etc.)" },
            "year": { "type": "string | null", "description": "Year of manufacture" },
            "year_is_approximate": { "type": "boolean", "default": false },
            "serial_number": { "type": "string | null" },
            "type": {
              "type": "string",
              "enum": ["electric", "acoustic", "bass", "classical", "other"]
            },
            "body_style": { "type": "string | null", "description": "Solid body, semi-hollow, hollow, dreadnought, etc." },
            "finish": { "type": "string | null", "description": "Color/finish name" },
            "current_finish_original": { "type": "boolean | null" },
            "neck_profile": { "type": "string | null" },
            "fretboard": { "type": "string | null", "description": "Fretboard material" },
            "pickups": { "type": "string | null", "description": "Pickup configuration" },
            "hardware": { "type": "string | null", "description": "Notable hardware details" }
          },
          "required": ["brand", "model", "type"]
        },
        "condition": {
          "type": "object",
          "properties": {
            "overall": {
              "type": "string",
              "enum": ["mint", "excellent", "very_good", "good", "fair", "project"]
            },
            "notes": { "type": "string | null" },
            "modifications": {
              "type": "array",
              "items": { "type": "string" }
            },
            "all_original": { "type": "boolean | null" }
          }
        },
        "provenance": {
          "type": "object",
          "properties": {
            "acquisition_date": { "type": "string | null", "description": "When owner acquired it" },
            "acquisition_method": {
              "type": "string | null",
              "enum": ["purchased", "inherited", "gift", "trade", "found", "other"]
            },
            "acquisition_source": { "type": "string | null", "description": "Where it was acquired" },
            "previous_owners": { "type": "string | null", "description": "Known history" },
            "years_owned": { "type": "number | null" },
            "for_sale": { "type": "boolean", "default": false }
          }
        },
        "story": {
          "type": "object",
          "properties": {
            "title": { "type": "string | null", "description": "User-given title for the story" },
            "narrative": { "type": "string | null", "description": "The full story" },
            "memories": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Key moments/memories"
            },
            "significance": {
              "type": "string | null",
              "enum": ["personal_favorite", "first_guitar", "workhorse", "collector_piece", "investment", "sentimental", "other"]
            }
          }
        },
        "media": {
          "type": "object",
          "properties": {
            "primary_image": { "type": "string", "format": "uri" },
            "images": {
              "type": "array",
              "items": { "type": "string", "format": "uri" }
            },
            "videos": {
              "type": "array",
              "items": { "type": "string", "format": "uri" }
            },
            "audio_clips": {
              "type": "array",
              "items": { "type": "string", "format": "uri" }
            }
          }
        },
        "metadata": {
          "type": "object",
          "properties": {
            "created_at": { "type": "string", "format": "date-time" },
            "updated_at": { "type": "string", "format": "date-time" },
            "claimed": { "type": "boolean", "default": false },
            "claim_token": { "type": "string | null", "description": "Unique token for claiming" },
            "featured_in_articles": {
              "type": "array",
              "items": { "type": "string" }
            },
            "view_count": { "type": "integer", "default": 0 },
            "tags": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        }
      }
    },
    
    "collector_prospect": {
      "description": "Profile for tracking potential collectors during outreach",
      "schema": {
        "id": { "type": "string", "format": "uuid" },
        "status": {
          "type": "string",
          "enum": ["prospect", "contacted", "engaged", "claimed", "active", "declined", "no_response"]
        },
        "source": {
          "type": "object",
          "properties": {
            "platform": { "type": "string", "enum": ["instagram", "youtube", "forum", "referral", "other"] },
            "handle": { "type": "string" },
            "profile_url": { "type": "string", "format": "uri" },
            "followers": { "type": "integer" },
            "scraped_at": { "type": "string", "format": "date-time" }
          }
        },
        "contact": {
          "type": "object",
          "properties": {
            "instagram_dm_available": { "type": "boolean" },
            "email": { "type": "string | null", "format": "email" },
            "preferred_channel": { "type": "string", "enum": ["instagram", "email", "other"] }
          }
        },
        "collection_preview": {
          "type": "object",
          "properties": {
            "preview_url": { "type": "string", "format": "uri" },
            "preview_token": { "type": "string" },
            "guitars_count": { "type": "integer" },
            "notable_pieces": {
              "type": "array",
              "items": { "type": "string" }
            },
            "collection_personality": { "type": "string" },
            "generated_at": { "type": "string", "format": "date-time" }
          }
        },
        "outreach": {
          "type": "object",
          "properties": {
            "first_contact_date": { "type": "string | null", "format": "date-time" },
            "first_contact_channel": { "type": "string | null" },
            "follow_ups": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "date": { "type": "string", "format": "date-time" },
                  "channel": { "type": "string" },
                  "response": { "type": "string | null" }
                }
              }
            },
            "status": {
              "type": "string",
              "enum": ["not_contacted", "awaiting_response", "engaged", "converted", "declined", "no_response"]
            }
          }
        },
        "notes": { "type": "string | null" }
      }
    },
    
    "outreach_log": {
      "description": "Individual outreach attempt tracking",
      "schema": {
        "id": { "type": "string", "format": "uuid" },
        "collector_id": { "type": "string", "format": "uuid" },
        "campaign": {
          "type": "string",
          "enum": ["system_a_featured", "system_b_collection", "manual"]
        },
        "outreach_type": {
          "type": "string",
          "enum": ["instagram_dm", "email", "comment", "other"]
        },
        "message_template_used": { "type": "string | null" },
        "message_sent": { "type": "string" },
        "personalization_hooks_used": {
          "type": "array",
          "items": { "type": "string" }
        },
        "sent_at": { "type": "string", "format": "date-time" },
        "opened_at": { "type": "string | null", "format": "date-time" },
        "responded_at": { "type": "string | null", "format": "date-time" },
        "response_type": {
          "type": "string | null",
          "enum": ["positive", "negative", "question", "no_response"]
        },
        "response_text": { "type": "string | null" },
        "converted": { "type": "boolean", "default": false },
        "conversion_date": { "type": "string | null", "format": "date-time" },
        "notes": { "type": "string | null" }
      }
    },
    
    "featured_article": {
      "description": "TWNG article featuring a guitar or collection",
      "schema": {
        "id": { "type": "string", "format": "uuid" },
        "status": {
          "type": "string",
          "enum": ["draft", "review", "published", "archived"]
        },
        "category": {
          "type": "string",
          "enum": ["guitar_spotlight", "rare_find", "story_behind_strings", "collection_feature", "history", "guide"]
        },
        "title": { "type": "string" },
        "subtitle": { "type": "string | null" },
        "body": { "type": "string", "description": "Article content in markdown" },
        "featured_guitar_ids": {
          "type": "array",
          "items": { "type": "string", "format": "uuid" }
        },
        "source_collector": {
          "type": "object",
          "properties": {
            "platform": { "type": "string" },
            "handle": { "type": "string" },
            "notified": { "type": "boolean" },
            "claimed": { "type": "boolean" }
          }
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" }
        },
        "seo": {
          "type": "object",
          "properties": {
            "meta_title": { "type": "string" },
            "meta_description": { "type": "string" },
            "slug": { "type": "string" }
          }
        },
        "metadata": {
          "type": "object",
          "properties": {
            "created_at": { "type": "string", "format": "date-time" },
            "published_at": { "type": "string | null", "format": "date-time" },
            "updated_at": { "type": "string", "format": "date-time" },
            "author": { "type": "string", "default": "TWNG Team" },
            "auto_generated": { "type": "boolean" },
            "view_count": { "type": "integer", "default": 0 }
          }
        }
      }
    }
  },
  
  "database_indexes": {
    "guitar_entry": [
      { "fields": ["owner_id"], "type": "btree" },
      { "fields": ["guitar.brand", "guitar.model"], "type": "btree" },
      { "fields": ["guitar.year"], "type": "btree" },
      { "fields": ["metadata.tags"], "type": "gin" },
      { "fields": ["source.platform_handle"], "type": "btree" },
      { "fields": ["metadata.claimed"], "type": "btree" }
    ],
    "collector_prospect": [
      { "fields": ["status"], "type": "btree" },
      { "fields": ["source.handle"], "type": "btree", "unique": true },
      { "fields": ["outreach.status"], "type": "btree" }
    ],
    "outreach_log": [
      { "fields": ["collector_id"], "type": "btree" },
      { "fields": ["sent_at"], "type": "btree" },
      { "fields": ["converted"], "type": "btree" }
    ]
  },
  
  "supabase_tables_sql": "-- Guitar Entries Table\nCREATE TABLE guitar_entries (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  owner_id UUID REFERENCES auth.users(id),\n  source JSONB NOT NULL DEFAULT '{}',\n  guitar JSONB NOT NULL,\n  condition JSONB DEFAULT '{}',\n  provenance JSONB DEFAULT '{}',\n  story JSONB DEFAULT '{}',\n  media JSONB DEFAULT '{}',\n  claimed BOOLEAN DEFAULT false,\n  claim_token TEXT UNIQUE,\n  tags TEXT[] DEFAULT '{}',\n  view_count INTEGER DEFAULT 0,\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  updated_at TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- Collector Prospects Table\nCREATE TABLE collector_prospects (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  status TEXT DEFAULT 'prospect',\n  source JSONB NOT NULL,\n  contact JSONB DEFAULT '{}',\n  collection_preview JSONB DEFAULT '{}',\n  outreach JSONB DEFAULT '{}',\n  notes TEXT,\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  updated_at TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- Outreach Log Table\nCREATE TABLE outreach_log (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  collector_id UUID REFERENCES collector_prospects(id),\n  campaign TEXT NOT NULL,\n  outreach_type TEXT NOT NULL,\n  message_template_used TEXT,\n  message_sent TEXT NOT NULL,\n  personalization_hooks TEXT[],\n  sent_at TIMESTAMPTZ DEFAULT NOW(),\n  opened_at TIMESTAMPTZ,\n  responded_at TIMESTAMPTZ,\n  response_type TEXT,\n  response_text TEXT,\n  converted BOOLEAN DEFAULT false,\n  conversion_date TIMESTAMPTZ,\n  notes TEXT\n);\n\n-- Featured Articles Table\nCREATE TABLE featured_articles (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  status TEXT DEFAULT 'draft',\n  category TEXT NOT NULL,\n  title TEXT NOT NULL,\n  subtitle TEXT,\n  body TEXT NOT NULL,\n  featured_guitar_ids UUID[],\n  source_collector JSONB DEFAULT '{}',\n  tags TEXT[] DEFAULT '{}',\n  seo JSONB DEFAULT '{}',\n  author TEXT DEFAULT 'TWNG Team',\n  auto_generated BOOLEAN DEFAULT false,\n  view_count INTEGER DEFAULT 0,\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  published_at TIMESTAMPTZ,\n  updated_at TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- Indexes\nCREATE INDEX idx_guitars_owner ON guitar_entries(owner_id);\nCREATE INDEX idx_guitars_brand_model ON guitar_entries((guitar->>'brand'), (guitar->>'model'));\nCREATE INDEX idx_guitars_tags ON guitar_entries USING GIN(tags);\nCREATE INDEX idx_guitars_claimed ON guitar_entries(claimed);\nCREATE INDEX idx_prospects_status ON collector_prospects(status);\nCREATE INDEX idx_prospects_handle ON collector_prospects((source->>'handle'));\nCREATE INDEX idx_outreach_collector ON outreach_log(collector_id);\nCREATE INDEX idx_outreach_converted ON outreach_log(converted);"
}
