{
  "name": "TWNG System A: Featured Guitar Content",
  "flow": [
    {
      "id": 1,
      "module": "builtin:BasicScheduler",
      "version": 1,
      "parameters": {
        "time": "07:00"
      },
      "mapper": {}
    },
    {
      "id": 2,
      "module": "apify:RunActor",
      "version": 1,
      "parameters": {},
      "mapper": {
        "actorId": "apify/instagram-hashtag-scraper",
        "input": "{\"hashtags\":[\"vintageguitar\",\"guitarcollection\",\"ngd\",\"gibsonlespaul\",\"fenderstratocaster\",\"gibsoncustom\",\"vintagegibson\",\"vintagefender\",\"guitargram\",\"geartalk\",\"guitaroftheday\",\"guitarporn\",\"myguitarcollection\",\"boutiqueguitars\"],\"resultsLimit\":500,\"searchType\":\"hashtag\",\"proxy\":{\"useApifyProxy\":true}}",
        "waitForFinish": "600"
      }
    },
    {
      "id": 3,
      "module": "builtin:BasicFeeder",
      "version": 1,
      "parameters": {},
      "mapper": {
        "array": "{{2.items}}"
      }
    },
    {
      "id": 4,
      "module": "builtin:BasicFilter",
      "version": 1,
      "parameters": {},
      "filter": {
        "name": "Engagement Filter",
        "conditions": [
          [
            {
              "a": "{{3.likesCount}}",
              "o": "number:gte",
              "b": "100"
            }
          ],
          [
            {
              "a": "{{length(3.caption)}}",
              "o": "number:gte",
              "b": "50"
            }
          ]
        ]
      }
    },
    {
      "id": 5,
      "module": "openai-gpt-3:createCompletion",
      "version": 1,
      "parameters": {},
      "mapper": {
        "model": "claude-sonnet-4-20250514",
        "max_tokens": "1024",
        "temperature": "0.3",
        "messages": [
          {
            "role": "user",
            "content": "You are evaluating Instagram posts for TWNG, a platform for guitar collectors. Your job is to identify posts worth featuring based on the guitar's interest level and the story quality.\n\nINPUT:\n- Post caption: {{3.caption}}\n- Likes: {{3.likesCount}}\n- Comments: {{3.commentsCount}}\n- Account followers: {{3.ownerFollowersCount}}\n- Post date: {{3.timestamp}}\n\nEVALUATION CRITERIA:\n\n1. GUITAR INTEREST (1-10):\n- Vintage (pre-1985): +3 points\n- Rare/unusual model: +2 points\n- Famous brand (Gibson, Fender, Martin, PRS, Gretsch): +1 point\n- Custom/boutique: +2 points\n- Historical significance mentioned: +2 points\n\n2. STORY QUALITY (1-10):\n- Personal history/memory shared: +3 points\n- Acquisition story (how they got it): +2 points\n- Technical details provided: +1 point\n- Emotional connection expressed: +2 points\n- Just \"NGD\" or minimal caption: -3 points\n\n3. ENGAGEMENT QUALITY:\n- Likes > 500: High\n- Likes 100-500: Medium\n- Likes < 100: Low\n\n4. ACCOUNT REACHABILITY:\n- 1K-10K followers: Highly reachable\n- 10K-50K followers: Reachable\n- 50K-100K followers: Difficult\n- 100K+ followers: Celebrity tier (skip)\n\nOUTPUT FORMAT (JSON only, no explanation):\n{\n  \"feature_worthy\": boolean,\n  \"overall_score\": number (1-10),\n  \"guitar_interest_score\": number,\n  \"story_quality_score\": number,\n  \"extracted_data\": {\n    \"brand\": string or null,\n    \"model\": string or null,\n    \"year\": string or null,\n    \"nickname\": string or null,\n    \"story_summary\": string (2-3 sentences)\n  },\n  \"suggested_angle\": string,\n  \"skip_reason\": string or null\n}\n\nOnly mark feature_worthy: true if overall_score >= 7."
          }
        ]
      },
      "metadata": {
        "note": "REPLACE with Anthropic Claude module - this uses OpenAI format as placeholder"
      }
    },
    {
      "id": 6,
      "module": "json:ParseJSON",
      "version": 1,
      "parameters": {},
      "mapper": {
        "json": "{{5.choices[0].message.content}}"
      },
      "metadata": {
        "note": "Adjust path based on your Claude module output: {{5.content[0].text}} for Anthropic native"
      }
    },
    {
      "id": 7,
      "module": "builtin:BasicFilter",
      "version": 1,
      "parameters": {},
      "filter": {
        "name": "Feature-Worthy Filter",
        "conditions": [
          [
            {
              "a": "{{6.feature_worthy}}",
              "o": "boolean:equal",
              "b": "true"
            }
          ],
          [
            {
              "a": "{{6.overall_score}}",
              "o": "number:gte",
              "b": "7"
            }
          ]
        ]
      }
    },
    {
      "id": 8,
      "module": "openai-gpt-3:createCompletion",
      "version": 1,
      "parameters": {},
      "mapper": {
        "model": "claude-sonnet-4-20250514",
        "max_tokens": "2048",
        "temperature": "0.7",
        "messages": [
          {
            "role": "user",
            "content": "You are writing a short feature article for TWNG, a platform for guitar collectors. The tone should be warm, knowledgeable, and celebratory of the guitar and its story.\n\nINPUT:\n- Guitar data: {{JSON.stringify(6.extracted_data)}}\n- Original caption: {{3.caption}}\n- Suggested angle: {{6.suggested_angle}}\n- Owner's Instagram handle: @{{3.ownerUsername}}\n\nARTICLE REQUIREMENTS:\n1. Length: 200-350 words\n2. Tone: Enthusiastic but not hyperbolic. Knowledgeable. Respectful.\n3. Structure:\n   - Hook opening (1-2 sentences that grab attention)\n   - The guitar itself (specs, history of the model)\n   - The owner's story (from their caption)\n   - Why it matters / what makes it special\n   - Closing that invites the owner to share more\n\n4. DO NOT:\n   - Make up facts not in the source material\n   - Speculate about value/price\n   - Be condescending or overly effusive\n   - Use clichéd phrases like \"axe\" or \"shred\"\n\n5. DO:\n   - Credit the owner by Instagram handle\n   - Include specific details from their caption\n   - Add brief historical context about the guitar model if relevant\n   - End with a soft call-to-action\n\nOUTPUT FORMAT (JSON only):\n{\n  \"title\": string (compelling, specific, 6-10 words),\n  \"subtitle\": string (one-line summary),\n  \"body\": string (the article text, with paragraph breaks as \\n\\n),\n  \"tags\": [array of relevant tags],\n  \"category\": \"Guitar Spotlight\" | \"Rare Find\" | \"Story Behind the Strings\" | \"Collection Feature\"\n}"
          }
        ]
      },
      "metadata": {
        "note": "REPLACE with Anthropic Claude module"
      }
    },
    {
      "id": 9,
      "module": "json:ParseJSON",
      "version": 1,
      "parameters": {},
      "mapper": {
        "json": "{{8.choices[0].message.content}}"
      }
    },
    {
      "id": 10,
      "module": "http:ActionSendData",
      "version": 3,
      "parameters": {
        "handleErrors": true
      },
      "mapper": {
        "url": "YOUR_TWNG_API_URL/api/admin/guitars",
        "method": "POST",
        "headers": [
          {
            "name": "Authorization",
            "value": "Bearer YOUR_TWNG_API_KEY"
          },
          {
            "name": "Content-Type",
            "value": "application/json"
          }
        ],
        "bodyType": "raw",
        "contentType": "application/json",
        "body": "{\"ownership_type\":\"system_discovered\",\"ownership_state\":\"featured\",\"source\":{\"type\":\"instagram\",\"platform_handle\":\"{{3.ownerUsername}}\",\"original_post_url\":\"{{3.url}}\",\"scraped_at\":\"{{now}}\"},\"guitar\":{\"brand\":\"{{6.extracted_data.brand}}\",\"model\":\"{{6.extracted_data.model}}\",\"year\":\"{{6.extracted_data.year}}\",\"type\":\"electric\"},\"story\":{\"narrative\":\"{{6.extracted_data.story_summary}}\",\"title\":\"{{6.extracted_data.nickname}}\"},\"media\":{\"primary_image\":\"{{3.displayUrl}}\",\"images\":[\"{{3.displayUrl}}\"]},\"tags\":{{JSON.stringify(9.tags)}}}"
      }
    },
    {
      "id": 11,
      "module": "http:ActionSendData",
      "version": 3,
      "parameters": {
        "handleErrors": true
      },
      "mapper": {
        "url": "YOUR_TWNG_API_URL/api/admin/articles",
        "method": "POST",
        "headers": [
          {
            "name": "Authorization",
            "value": "Bearer YOUR_TWNG_API_KEY"
          },
          {
            "name": "Content-Type",
            "value": "application/json"
          }
        ],
        "bodyType": "raw",
        "contentType": "application/json",
        "body": "{\"status\":\"draft\",\"category\":\"{{9.category}}\",\"title\":\"{{9.title}}\",\"subtitle\":\"{{9.subtitle}}\",\"body\":\"{{9.body}}\",\"featured_guitar_ids\":[\"{{10.data.id}}\"],\"source_collector\":{\"platform\":\"instagram\",\"handle\":\"{{3.ownerUsername}}\",\"notified\":false,\"claimed\":false},\"tags\":{{JSON.stringify(9.tags)}},\"auto_generated\":true}"
      }
    },
    {
      "id": 12,
      "module": "google-sheets:addRow",
      "version": 2,
      "parameters": {},
      "mapper": {
        "mode": "select",
        "spreadsheetId": "YOUR_SHEET_ID",
        "sheetId": "Featured Content Queue",
        "includesHeaders": true,
        "values": [
          ["{{formatDate(now; \"YYYY-MM-DD HH:mm\")}}"],
          ["@{{3.ownerUsername}}"],
          ["{{3.url}}"],
          ["{{10.data.id}}"],
          ["{{11.data.id}}"],
          ["YOUR_TWNG_URL/articles/{{11.data.slug}}"],
          ["{{9.title}}"],
          ["{{6.overall_score}}"],
          ["{{6.extracted_data.brand}} {{6.extracted_data.model}}"],
          ["pending_review"],
          ["Hey @{{3.ownerUsername}}! Your {{6.extracted_data.year}} {{6.extracted_data.brand}} {{6.extracted_data.model}} caught our eye — we featured it on TWNG. We're building a platform for guitar collectors to document and share their collections. Would love for you to claim your entry and add the full story!"],
          ["{{3.ownerFollowersCount}}"]
        ]
      }
    },
    {
      "id": 13,
      "module": "slack:createMessage",
      "version": 1,
      "parameters": {},
      "mapper": {
        "channel": "#twng-content",
        "text": ":guitar: *New Featured Article Ready for Review*\n\n*Title:* {{9.title}}\n*Guitar:* {{6.extracted_data.brand}} {{6.extracted_data.model}}\n*Owner:* @{{3.ownerUsername}} ({{3.ownerFollowersCount}} followers)\n*Score:* {{6.overall_score}}/10\n\nReview Article | Original Post"
      }
    }
  ],
  "metadata": {
    "version": 1,
    "scenario": {
      "roundtrips": 1,
      "maxErrors": 3,
      "autoCommit": true,
      "sequential": false
    }
  }
}
